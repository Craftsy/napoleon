!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var r={exports:{}};e(r.exports),t.napoleon=r.exports}}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function t(r){var n=this;e(this,t),r=t.getPathname(r);var o=r.match(/(.*?)($|\?(.*))/),i=o[1],a=o[3];this.segments=i.split("/").filter(function(t){return t.length>0}),this.querystring={},null!=a&&a.split("&").forEach(function(t){var e=t.split("="),r=e[0],o=e[1];n.querystring[r]=decodeURIComponent(o)})}return t.isSegmentKey=function(t){return"{"===t.charAt(0)&&"}"===t.charAt(t.length-1)},t.getSegmentKey=function(e){var r=null;return t.isSegmentKey(e)&&(r=e.slice(1,-1)),r},t.getPathname=function(t){var e=t.match(/.*?\/\/.*?\//),r=e?e[0]:"/";return t.replace(r,"/")},t.prototype.getUrlForState=function(e){for(var r=[],n=this.segments.reduce(function(n,o){var i=t.getSegmentKey(o);if(r.push(i),null!=i){var a=e[i];null!=a&&(n+="/"+a)}else n+="/"+o;return n},""),o=[],i=Object.keys(e),a=0;a<i.length;a++){var s=i[a];if(-1===r.indexOf(s)){var l=e[s];o.push(s+"="+encodeURIComponent(l))}}return o.length>0&&(n+="?"+o.join("&")),n},t.prototype.extractParameters=function(e){var r=new t(e),n={};this.segments.forEach(function(e,o){var i=t.getSegmentKey(e);null!=i?n[i]=r.segments[o]:"*"===e&&(n.blat=r.segments.slice(o).join("/"))});var o=Object.keys(r.querystring);return o.forEach(function(t){if(!n.hasOwnProperty(t)){var e=r.querystring[t];n[t]=e}}),n},t.prototype.toString=function(){var t="/"+this.segments.join("/"),e=[],r="",n=!0,o=!1,i=void 0;try{for(var a,s=Object.keys(this.querystring)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;e.push("key="+encodeURIComponent(this.querystring[l]))}}catch(u){o=!0,i=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw i}}return e.length>0&&(r="?"+e.join("&")),""+t+r},t}();t.URLStructure=r;var n="?dynamic?",o="?blat?",i=function(){function t(){e(this,t),this.leaf=null,this.children={}}return t.prototype.addRoute=function(e,i){var a=arguments.length<=2||void 0===arguments[2]?0:arguments[2],s=i.segments[a];if(null==s){if(null!=this.leaf)throw new Error("Route "+i+" already mounted: "+this.leaf.urlStructure);this.leaf={urlStructure:i,handler:e}}else{var l=void 0;if("*"===s){if(a<i.segments.length-1)throw new Error("Route "+i+" cannot have path segments after the blat (*)");l=o}else{var u=r.getSegmentKey(s);l=null==u?s:n}this.children.hasOwnProperty(l)||(this.children[l]=new t),this.children[l].addRoute(e,i,a+1)}},t.prototype.matchPath=function(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=null;if(e===t.segments.length)r=this.leaf,null==r&&0===e&&null==r&&this.children.hasOwnProperty(o)&&(r=this.children[o].leaf);else{var i=t.segments[e];this.children.hasOwnProperty(i)&&(r=this.children[i].matchPath(t,e+1)),null==r&&this.children.hasOwnProperty(n)&&(r=this.children[n].matchPath(t,e+1)),null==r&&this.children.hasOwnProperty(o)&&(r=this.children[o].leaf)}return r},t}();t.TreeRoute=i;var a=function(){function t(){e(this,t),this.namedRoutes={},this.trees={}}return t.prototype.mount=function(t){var e=t.method,n=void 0===e?"get":e,o=t.url,a=t.handler,s=t.name;n=n.toLowerCase();var l=new r(o);if(null==this.trees[n]&&(this.trees[n]=new i),this.trees[n].addRoute(a,l),null!=s){if(this.namedRoutes.hasOwnProperty(s))throw new Error("Conflict for route name "+s+": "+o+" / "+this.namedRoutes[s].url);this.namedRoutes[s]=t}return this},t.prototype.matchRoute=function(t,e){t=t.toLowerCase();var n=new r(e),o=null;return this.trees.hasOwnProperty(t)&&(o=this.trees[t].matchPath(n)),o},t.prototype.route=function(t,e,r){t=t.toLowerCase();var n=this.matchRoute(t,e),o=null;return null!=n&&(o=n.urlStructure.extractParameters(e),n.handler(o,r)),o},t.prototype.getNamedRoute=function(t){return this.namedRoutes[t]||null},t}();t.Router=a;var s=function(){var t=null,e=null,n={isNapoleon:!0,url:{},extras:{}},o=function(){n=null==window.history.state||window.history.state.isNapoleon!==!0?{isNapoleon:!0,url:t.extractParameters(location.href),extras:{}}:window.history.state;var r=n,o=r.url,i=r.extras;e({url:o,extras:i})};return{attach:function(n){var i=n.url,a=n.onStateChange;if(null==i)throw new Error("Missing `url` in Napoleon config");if(null==a)throw new Error("Missing `onStateChange` in Napoleon config");t=new r(i),e=a,window.addEventListener("popstate",o),o()},modifyState:function(e){var r=e.url,i=e.extras,a=e.replace;if(null!=r)for(var s in r)if(r.hasOwnProperty(s)){var l=r[s];null==l?delete n.url[s]:n.url[s]=l}if(null!=i)for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];null==l?delete n.extras[s]:n.extras[s]=l}a===!0?window.history.replaceState(n,"",t.getUrlForState(n.url)):window.history.pushState(n,"",t.getUrlForState(n.url)),o()}}}(void 0);t["default"]=s});