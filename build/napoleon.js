!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var n={exports:{}};e(n.exports),t.napoleon=n.exports}}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(n){var r=this;e(this,t);var o=n.match(/.*?\/\/.*?\//),i=o?o[0]:"/";n=n.replace(i,"/");var a=n.match(/(.*?)($|\?(.*))/),s=a[1],u=a[3];this.url=n,this.components=s.split("/").filter(function(t){return t.length>0}),this.querystring={},null!=u&&u.split("&").forEach(function(t){var e=t.split("="),n=e[0],o=e[1];r.querystring[n]=decodeURIComponent(o)})}return t.isComponentKey=function(t){return"{"===t.charAt(0)&&"}"===t.charAt(t.length-1)},t.getComponentKey=function(e){var n=null;return t.isComponentKey(e)&&(n=e.slice(1,-1)),n},t.prototype.getUrlForState=function(e){for(var n=[],r=this.components.reduce(function(r,o){var i=t.getComponentKey(o);if(n.push(i),null!=i){var a=e[i];null!=a&&(r+="/"+a)}else r+="/"+o;return r},""),o=[],i=Object.keys(e),a=0;a<i.length;a++){var s=i[a];if(-1===n.indexOf(s)){var u=e[s];o.push(s+"="+encodeURIComponent(u))}}return o.length>0&&(r+="?"+o.join("&")),r},t.prototype.extractParameters=function(e){var n=new t(e),r={};this.components.forEach(function(e,o){var i=t.getComponentKey(e);null!=i&&(r[i]=n.components[o])});var o=Object.keys(n.querystring);return o.forEach(function(t){if(!r.hasOwnProperty(t)){var e=n.querystring[t];r[t]=e}}),r},t}();t.URLStructure=n;var r="?dynamic?",o=function(){function t(){e(this,t),this.leaf=null,this.children={}}return t.prototype.addRoute=function(e,o){var i=void 0===arguments[2]?0:arguments[2],a=o.components[i];if(null==a){if(null!=this.leaf)throw new Error("Route "+o.path+" already mounted: "+this.leaf.urlStructure.path);this.leaf={urlStructure:o,handler:e}}else{var s=n.getComponentKey(a),u=null==s?a:r;this.children.hasOwnProperty(u)||(this.children[u]=new t),this.children[u].addRoute(e,o,i+1)}},t.prototype.matchPath=function(t){var e=void 0===arguments[1]?0:arguments[1],n=null;if(e===t.components.length)n=this.leaf;else{var o=t.components[e];this.children.hasOwnProperty(o)&&(n=this.children[o].matchPath(t,e+1)),null==n&&this.children.hasOwnProperty(r)&&(n=this.children[r].matchPath(t,e+1))}return n},t}();t.TreeRoute=o;var i=function(){function t(){e(this,t),this.trees={}}return t.prototype.mount=function(t,e,r){t=t.toLowerCase();var i=new n(e);return null==this.trees[t]&&(this.trees[t]=new o),this.trees[t].addRoute(r,i),this},t.prototype.matchRoute=function(t,e){t=t.toLowerCase();var r=new n(e);return this.trees[t].matchPath(r)},t.prototype.route=function(t,e){t=t.toLowerCase();var n=this.matchRoute(t,e);if(null!=n){var r=n.urlStructure.extractParameters(e);n.handler(e,r)}},t}();t.Router=i;var a=function(){var t=null,e=null,r={isNapoleon:!0,url:{},extras:{}},o=function(){r=null==window.history.state||window.history.state.isNapoleon!==!0?{isNapoleon:!0,url:t.extractParameters(location.href),extras:{}}:window.history.state;var n=r.url,o=r.extras;e({url:n,extras:o})};return{attach:function(r){var i=r.url,a=r.onStateChange;if(null==i)throw new Error("Missing `url` in Napoleon config");if(null==a)throw new Error("Missing `onStateChange` in Napoleon config");t=new n(i),e=a,window.addEventListener("popstate",o),o()},modifyState:function(e){var n=e.url,i=e.extras,a=e.replace;if(null!=n)for(var s in n)if(n.hasOwnProperty(s)){var u=n[s];null==u?delete r.url[s]:r.url[s]=u}if(null!=i)for(var s in i)if(i.hasOwnProperty(s)){var u=i[s];null==u?delete r.extras[s]:r.extras[s]=u}a===!0?window.history.replaceState(r,"",t.getUrlForState(r.url)):window.history.pushState(r,"",t.getUrlForState(r.url)),o()}}}(void 0);t["default"]=a});