!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var n={exports:{}};e(n.exports),t.napoleon=n.exports}}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(n){var r=this;e(this,t),n=t.getPathname(n);var o=n.match(/(.*?)($|\?(.*))/),i=o[1],a=o[3];this.segments=i.split("/").filter(function(t){return t.length>0}),this.querystring={},null!=a&&a.split("&").forEach(function(t){var e=t.split("="),n=e[0],o=e[1];r.querystring[n]=decodeURIComponent(o)})}return t.isSegmentKey=function(t){return"{"===t.charAt(0)&&"}"===t.charAt(t.length-1)},t.getSegmentKey=function(e){var n=null;return t.isSegmentKey(e)&&(n=e.slice(1,-1)),n},t.getPathname=function(t){var e=t.match(/^[^?]*?\/\/.*?\//),n=e?e[0]:"/";return t.replace(n,"/")},t.prototype.getUrlForState=function(e){for(var n=[],r=this.segments.map(function(r){var o=t.getSegmentKey(r);if(n.push(o),null!=o){var i=e[o];return null!=i?i:null}return r}).filter(function(t){return null!=t}),o="/"+r.join("/"),i=[],a=Object.keys(e),s=0;s<a.length;s++){var l=a[s];if(-1===n.indexOf(l)){var u=e[l];i.push(l+"="+encodeURIComponent(u))}}return i.length>0&&(o+="?"+i.join("&")),o},t.prototype.extractParameters=function(e){var n=new t(e),r={};this.segments.forEach(function(e,o){var i=t.getSegmentKey(e);null!=i?r[i]=n.segments[o]:"*"===e&&(r.blat=n.segments.slice(o).join("/"))});var o=Object.keys(n.querystring);return o.forEach(function(t){if(!r.hasOwnProperty(t)){var e=n.querystring[t];r[t]=e}}),r},t.prototype.toString=function(){var t="/"+this.segments.join("/"),e=[],n="",r=!0,o=!1,i=void 0;try{for(var a,s=Object.keys(this.querystring)[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;e.push("key="+encodeURIComponent(this.querystring[l]))}}catch(u){o=!0,i=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw i}}return e.length>0&&(n="?"+e.join("&")),""+t+n},t}();t.URLStructure=n;var r="?dynamic?",o="?blat?",i=function(){function t(){e(this,t),this.leaf=null,this.children={}}return t.prototype.addRoute=function(e,i,a){var s=arguments.length<=3||void 0===arguments[3]?0:arguments[3],l=a.segments[s];if(null==l){if(null!=this.leaf)throw new Error("Route "+a+" already mounted: "+this.leaf.urlStructure);this.leaf={urlStructure:a,handler:i},null!=e&&(this.leaf.name=e)}else{var u=void 0;if("*"===l){if(s<a.segments.length-1)throw new Error("Route "+a+" cannot have path segments after the blat (*)");u=o}else{var h=n.getSegmentKey(l);u=null==h?l:r}this.children.hasOwnProperty(u)||(this.children[u]=new t),this.children[u].addRoute(e,i,a,s+1)}},t.prototype.matchPath=function(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=null;if(e===t.segments.length)n=this.leaf,null==n&&0===e&&null==n&&this.children.hasOwnProperty(o)&&(n=this.children[o].leaf);else{var i=t.segments[e];this.children.hasOwnProperty(i)&&(n=this.children[i].matchPath(t,e+1)),null==n&&this.children.hasOwnProperty(r)&&(n=this.children[r].matchPath(t,e+1)),null==n&&this.children.hasOwnProperty(o)&&(n=this.children[o].leaf)}return n},t}();t.TreeRoute=i;var a=function(){function t(){e(this,t),this.namedRoutes={},this.trees={}}return t.prototype.mount=function(t){var e=t.method,r=void 0===e?"get":e,o=t.url,a=t.handler,s=t.name;r=r.toLowerCase();var l=new n(o);if(null==this.trees[r]&&(this.trees[r]=new i),this.trees[r].addRoute(s,a,l),null!=s){if(this.namedRoutes.hasOwnProperty(s))throw new Error("Conflict for route name "+s+": "+o+" / "+this.namedRoutes[s].url);this.namedRoutes[s]=t}return this},t.prototype.matchRoute=function(t,e){t=t.toLowerCase();var r=new n(e),o=null;return this.trees.hasOwnProperty(t)&&(o=this.trees[t].matchPath(r)),o},t.prototype.route=function(t,e,n){t=t.toLowerCase();var r=this.matchRoute(t,e),o=null;return null!=r&&(o=r.urlStructure.extractParameters(e),r.handler(o,n)),o},t.prototype.getNamedRoute=function(t){return this.namedRoutes[t]||null},t}();t.Router=a;var s=function(){var t=null,e=null,r={isNapoleon:!0,url:{},extras:{}},o=function(){r=null==window.history.state||window.history.state.isNapoleon!==!0?{isNapoleon:!0,url:t.extractParameters(location.href),extras:{}}:window.history.state;var n=r,o=n.url,i=n.extras;e({url:o,extras:i})};return{attach:function(r){var i=r.url,a=r.onStateChange;if(null==i)throw new Error("Missing `url` in Napoleon config");if(null==a)throw new Error("Missing `onStateChange` in Napoleon config");t=new n(i),e=a,window.addEventListener("popstate",o),o()},modifyState:function(e){var n=e.url,i=e.extras,a=e.replace;if(null!=n)for(var s in n)if(n.hasOwnProperty(s)){var l=n[s];null==l?delete r.url[s]:r.url[s]=l}if(null!=i)for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];null==l?delete r.extras[s]:r.extras[s]=l}a===!0?window.history.replaceState(r,"",t.getUrlForState(r.url)):window.history.pushState(r,"",t.getUrlForState(r.url)),o()}}}(void 0);t["default"]=s});