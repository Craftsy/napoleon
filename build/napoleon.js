!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var r={exports:{}};e(r.exports),t.napoleon=r.exports}}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function t(r){var n=this;e(this,t),r=t.getPathname(r);var a=r.match(/(.*?)($|\?(.*))/),o=a[1],i=a[3];this.segments=o.split("/").filter(function(t){return t.length>0}),this.querystring={},null!=i&&i.split("&").forEach(function(t){var e=t.split("="),r=e[0],a=e[1];n.querystring[r]=decodeURIComponent(a)})}return t.isSegmentKey=function(t){return"{"===t.charAt(0)&&"}"===t.charAt(t.length-1)},t.getSegmentKey=function(e){var r=null;return t.isSegmentKey(e)&&(r=e.slice(1,-1)),r},t.getPathname=function(t){var e=t.match(/.*?\/\/.*?\//),r=e?e[0]:"/";return t.replace(r,"/")},t.prototype.getUrlForState=function(e){for(var r=[],n=this.segments.reduce(function(n,a){var o=t.getSegmentKey(a);if(r.push(o),null!=o){var i=e[o];null!=i&&(n+="/"+i)}else n+="/"+a;return n},""),a=[],o=Object.keys(e),i=0;i<o.length;i++){var s=o[i];if(-1===r.indexOf(s)){var u=e[s];a.push(s+"="+encodeURIComponent(u))}}return a.length>0&&(n+="?"+a.join("&")),n},t.prototype.extractParameters=function(e){var r=new t(e),n={};this.segments.forEach(function(e,a){var o=t.getSegmentKey(e);null!=o&&(n[o]=r.segments[a])});var a=Object.keys(r.querystring);return a.forEach(function(t){if(!n.hasOwnProperty(t)){var e=r.querystring[t];n[t]=e}}),n},t}();t.URLStructure=r;var n="?dynamic?",a=function(){function t(){e(this,t),this.leaf=null,this.children={}}return t.prototype.addRoute=function(e,a){var o=void 0===arguments[2]?0:arguments[2],i=a.segments[o];if(null==i){if(null!=this.leaf)throw new Error("Route "+a.path+" already mounted: "+this.leaf.urlStructure.path);this.leaf={urlStructure:a,handler:e}}else{var s=r.getSegmentKey(i),u=null==s?i:n;this.children.hasOwnProperty(u)||(this.children[u]=new t),this.children[u].addRoute(e,a,o+1)}},t.prototype.matchPath=function(t){var e=void 0===arguments[1]?0:arguments[1],r=null;if(e===t.segments.length)r=this.leaf;else{var a=t.segments[e];this.children.hasOwnProperty(a)&&(r=this.children[a].matchPath(t,e+1)),null==r&&this.children.hasOwnProperty(n)&&(r=this.children[n].matchPath(t,e+1))}return r},t}();t.TreeRoute=a;var o=function(){function t(){e(this,t),this.trees={}}return t.prototype.mount=function(t,e,n){t=t.toLowerCase();var o=new r(e);return null==this.trees[t]&&(this.trees[t]=new a),this.trees[t].addRoute(n,o),this},t.prototype.matchRoute=function(t,e){t=t.toLowerCase();var n=new r(e),a=null;return this.trees.hasOwnProperty(t)&&(a=this.trees[t].matchPath(n)),a},t.prototype.route=function(t,e){t=t.toLowerCase();var r=this.matchRoute(t,e);if(null!=r){var n=r.urlStructure.extractParameters(e);r.handler(n)}},t}();t.Router=o;var i=function(){var t=null,e=null,n={isNapoleon:!0,url:{},extras:{}},a=function(){n=null==window.history.state||window.history.state.isNapoleon!==!0?{isNapoleon:!0,url:t.extractParameters(location.href),extras:{}}:window.history.state;var r=n.url,a=n.extras;e({url:r,extras:a})};return{attach:function(n){var o=n.url,i=n.onStateChange;if(null==o)throw new Error("Missing `url` in Napoleon config");if(null==i)throw new Error("Missing `onStateChange` in Napoleon config");t=new r(o),e=i,window.addEventListener("popstate",a),a()},modifyState:function(e){var r=e.url,o=e.extras,i=e.replace;if(null!=r)for(var s in r)if(r.hasOwnProperty(s)){var u=r[s];null==u?delete n.url[s]:n.url[s]=u}if(null!=o)for(var s in o)if(o.hasOwnProperty(s)){var u=o[s];null==u?delete n.extras[s]:n.extras[s]=u}i===!0?window.history.replaceState(n,"",t.getUrlForState(n.url)):window.history.pushState(n,"",t.getUrlForState(n.url)),a()}}}(void 0);t["default"]=i});